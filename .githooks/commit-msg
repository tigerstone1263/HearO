#!/bin/sh
set -eu

msg_file="$1"

# Allow merge commits.
if grep -q '^Merge ' "$msg_file"; then
  exit 0
fi

if ! grep -Eq '^Task: P[0-4]-[0-9]{2}\b' "$msg_file"; then
  echo "ERROR: Commit message must include a Task ID like: Task: P1-01" >&2
  echo "See SPEC.md checklist for valid Task IDs." >&2
  exit 1
fi

if ! grep -Eq '^Tests:' "$msg_file"; then
  echo "ERROR: Commit message must include a Tests: line." >&2
  exit 1
fi
